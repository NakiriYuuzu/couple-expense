import{b as e}from"./ExpenseGroup-BUh6gZZu.js";import{b as t}from"./TopBar-DUw4tseo.js";import{b as n,d as r}from"./usePullToRefresh-BK7dh9gb.js";import{b as i}from"./Label-CwhSjOJt.js";import{b as a,c as o,d as s,e as c,f as l}from"./DialogTitle-Ck2Dyjf6.js";import{D as ee,E as te,F as ne,I as re,J as ie,M as ae,O as oe,P as se,Q as u,a$ as d,aA as ce,aS as le,aT as f,aU as ue,aW as p,aY as m,aZ as h,a_ as g,b0 as _,b2 as v,b3 as y,b4 as b,be as x,bg as S,bi as de,bm as C,br as w,bv as T,bw as E,bz as D,c as O,h as fe,j as pe,r as k,t as me,u as he,v as ge,w as _e,x as A}from"./index-DaV3G9Q-.js";import{b as j}from"./Card-BpQYwhaM.js";import{b as M}from"./CardContent-00AvZF2e.js";import{b as N}from"./DialogFooter-CkrDA5yQ.js";const ve=se(`lock`,[[`rect`,{width:`18`,height:`11`,x:`3`,y:`11`,rx:`2`,ry:`2`,key:`1w4ew1`}],[`path`,{d:`M7 11V7a5 5 0 0 1 10 0v4`,key:`fwvmzm`}]]),ye={class:`min-h-screen bg-background`},be={class:`px-4 pb-20`},xe={class:`mt-6 grid gap-4 sm:grid-cols-2`},Se={class:`flex items-center justify-between`},Ce={class:`text-sm font-medium text-white/80`},we={class:`flex items-center gap-2`},Te={key:0,class:`bg-white/20 rounded-full p-1`,title:`使用情侶預算設定`},Ee=[`title`],De={class:`mt-2 text-2xl sm:text-3xl font-bold text-white`},Oe={class:`mt-1 text-xs text-white/60`},ke={class:`text-sm font-medium text-white/80`},Ae={class:`mt-2 text-2xl sm:text-3xl font-bold text-white`},je={class:`mt-8 animate-fade-in-up`},Me={class:`mb-4 text-lg font-semibold text-foreground`},Ne={class:`space-y-4`},Pe={class:`bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-2`},Fe={class:`flex justify-between text-sm`},Ie={class:`text-muted-foreground`},Le={class:`font-medium`},Re={class:`flex justify-between text-sm`},ze={class:`text-muted-foreground`},Be={class:`font-medium text-red-600`},Ve={class:`flex justify-between text-sm font-semibold`},P={class:`grid gap-4 py-4`},He={class:`grid grid-cols-4 items-center gap-4`},Ue={for:`balance`,class:`text-right text-sm font-medium`},We={class:`grid gap-4 py-4`},Ge={class:`space-y-2`},Ke={class:`space-y-2`},qe={class:`space-y-2`},Je={class:`grid grid-cols-3 gap-3`},Ye=[`onClick`],Xe={class:`text-xs font-medium text-foreground`},Ze={class:`space-y-2`},Qe={class:`flex flex-col sm:flex-row gap-2 w-full sm:w-auto`};var F=b({__name:`Home`,setup(se){let{t:b}=ee(),O=le(),F=fe(),I=pe(),{expenses:L}=k(F),{isInCouple:R,coupleSettings:z}=k(I),B=w(2e3),V=w(!1),H=w(``),U=m(()=>R.value&&z.value?.monthly_budget?z.value.monthly_budget:B.value),W=m(()=>R.value&&z.value?.monthly_budget),$e=()=>{if(W.value){f.info(`請前往情侶設定調整預算`,{action:{label:`前往設定`,onClick:()=>O.push(`/settings`)}});return}H.value=B.value.toString(),V.value=!0},G=()=>{let e=parseFloat(H.value);!isNaN(e)&&e>=0&&(B.value=e,V.value=!1,H.value=``)},et=()=>{V.value=!1,H.value=``},K=w(!1),q=w(null),J=m(()=>[{id:`food`,label:b(`expense.categories.food`),icon:te},{id:`pet`,label:b(`expense.categories.pet`),icon:ae},{id:`shopping`,label:b(`expense.categories.shopping`),icon:ne},{id:`transport`,label:b(`expense.categories.transport`),icon:r},{id:`home`,label:b(`expense.categories.home`),icon:ie},{id:`other`,label:b(`expense.categories.other`),icon:re}]),Y=w({title:``,amount:0,category:`food`,date:``}),X=w(),tt=e=>{let t=J.value.find(t=>t.id===e.category);return{id:e.id,title:e.title,amount:`NT ${Math.round(e.amount)}`,category:e.category,icon:t?.icon,user:e.user}},Z=m(()=>{let e=new Date().toISOString().substring(0,7),t=L.value.filter(t=>t.date.startsWith(e));return t.reduce((e,t)=>e+t.amount,0)}),Q=m(()=>U.value-Z.value),$=m(()=>Q.value<0),nt=m(()=>{let e={},t=[...L.value].sort((e,t)=>t.date.localeCompare(e.date)),n=t.slice(0,15);return n.forEach(t=>{let n=t.date.replace(/-/g,`/`);e[n]||(e[n]=[]),e[n].push(tt(t))}),Object.entries(e).map(([e,t])=>({date:e,expenses:t})).sort((e,t)=>t.date.localeCompare(e.date)).slice(0,3)}),rt=e=>{let t=L.value.find(t=>t.id===e.id);if(t){Y.value={title:t.title,amount:t.amount,category:t.category,date:t.date.replace(/-/g,`/`)};let e=t.date.split(`-`);X.value=ce(`${e[0]}-${e[1]}-${e[2]}`),q.value=t,K.value=!0}},it=e=>{e&&(Y.value.date=`${e.year}/${String(e.month).padStart(2,`0`)}/${String(e.day).padStart(2,`0`)}`)},at=e=>e||b(`home.selectDate`),ot=async()=>{if(q.value)try{let e=Y.value.date.replace(/\//g,`-`);await F.updateExpense(q.value.id,{title:Y.value.title,amount:Math.round(Y.value.amount),category:Y.value.category,date:e}),K.value=!1,q.value=null}catch(e){console.error(`更新費用失敗:`,e)}},st=()=>{K.value=!1,q.value=null},ct=async()=>{if(q.value){let e={...q.value},t=e.title;try{K.value=!1,q.value=null,await F.deleteExpense(e.id),f.success(`已刪除「${t}」`,{action:{label:`復原`,onClick:async()=>{try{await F.addExpense({title:e.title,amount:e.amount,category:e.category,icon:e.icon,date:e.date}),f.success(`已復原費用記錄`),await F.fetchExpenses()}catch(e){console.error(`復原失敗:`,e),f.error(`復原失敗，請稍後重試`)}}},duration:5e3})}catch(e){console.error(`刪除費用失敗:`,e),f.error(`刪除失敗，請稍後重試`)}}};return n({onRefresh:async()=>{try{await Promise.all([F.fetchExpenses(),I.fetchUserProfile()]),f.success(`資料已更新`)}catch(e){console.error(`刷新失敗:`,e),f.error(`刷新失敗，請稍後重試`)}}}),(n,r)=>(x(),_(`div`,ye,[y(t),h(`main`,be,[h(`div`,xe,[y(T(j),{class:E([`relative overflow-hidden border-0 shadow-lg animate-slide-in-left hover:shadow-xl transition-all duration-300`,W.value?`cursor-not-allowed`:`cursor-pointer`]),onClick:$e},{default:C(()=>[h(`div`,{class:E([`absolute inset-0 bg-gradient-to-br transition-all duration-300`,$.value?`from-red-500 to-red-600`:`from-brand-primary to-brand-primary/80`])},null,2),y(T(M),{class:`relative p-4 sm:p-6`},{default:C(()=>[h(`div`,Se,[h(`p`,Ce,D($.value?T(b)(`home.insufficientBalance`):T(b)(`home.remainingBalance`)),1),h(`div`,we,[W.value?(x(),_(`div`,Te,[y(T(ve),{class:`w-4 h-4 text-white`})])):d(``,!0),$.value?(x(),_(`div`,{key:1,class:`bg-white/20 rounded-full p-1`,title:T(b)(`home.budgetExceeded`)},r[6]||=[h(`svg`,{class:`w-4 h-4 text-white`,fill:`currentColor`,viewBox:`0 0 20 20`},[h(`path`,{"fill-rule":`evenodd`,d:`M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z`,"clip-rule":`evenodd`})],-1)],8,Ee)):d(``,!0)])]),h(`p`,De,[h(`span`,{class:E($.value?`text-white`:``)},D($.value?`-`:``)+`$`+D(Math.round(Math.abs(Q.value))),3)]),h(`p`,Oe,D(W.value?`使用情侶預算設定`:T(b)(`home.remainingBalanceDesc`)),1)]),_:1})]),_:1},8,[`class`]),y(T(j),{class:`relative overflow-hidden border-0 shadow-lg animate-slide-in-right hover:shadow-xl transition-all duration-300 cursor-pointer`},{default:C(()=>[r[7]||=h(`div`,{class:`absolute inset-0 bg-gradient-to-br from-brand-primary/60 to-brand-primary`},null,-1),y(T(M),{class:`relative p-4 sm:p-6`},{default:C(()=>[h(`p`,ke,D(T(b)(`home.totalSpent`)),1),h(`p`,Ae,`NT $`+D(Math.round(Z.value)),1)]),_:1})]),_:1,__:[7]})]),h(`div`,je,[h(`h2`,Me,D(T(b)(`home.recentSpending`)),1),h(`div`,Ne,[(x(!0),_(p,null,S(nt.value,t=>(x(),g(e,{key:t.date,date:t.date,expenses:t.expenses,"show-user":T(R),onExpenseClick:rt},null,8,[`date`,`expenses`,`show-user`]))),128))])])]),y(T(l),{open:V.value,"onUpdate:open":r[1]||=e=>V.value=e},{default:C(()=>[y(T(c),{class:`sm:max-w-md`},{default:C(()=>[y(T(o),null,{default:C(()=>[y(T(a),null,{default:C(()=>[v(D(T(b)(`home.setBalance`)),1)]),_:1}),y(T(s),null,{default:C(()=>[v(D(T(b)(`home.setBalanceDesc`))+` $`+D(Math.round(U.value)),1)]),_:1})]),_:1}),h(`div`,Pe,[h(`div`,Fe,[h(`span`,Ie,D(T(b)(`home.balance`))+`:`,1),h(`span`,Le,`$`+D(Math.round(U.value)),1)]),h(`div`,Re,[h(`span`,ze,D(T(b)(`home.totalSpent`))+`:`,1),h(`span`,Be,`-$`+D(Math.round(Z.value)),1)]),r[8]||=h(`hr`,{class:`border-gray-200 dark:border-gray-700`},null,-1),h(`div`,Ve,[h(`span`,null,D(T(b)(`home.remainingBalance`))+`:`,1),h(`span`,{class:E($.value?`text-red-600`:`text-green-600`)},` $`+D(Math.round(Q.value)),3)])]),h(`div`,P,[h(`div`,He,[h(`label`,Ue,D(T(b)(`home.amount`)),1),y(T(A),{id:`balance`,modelValue:H.value,"onUpdate:modelValue":r[0]||=e=>H.value=e,type:`number`,step:`1`,min:`0`,placeholder:T(b)(`home.enterNewBalance`),class:`col-span-3`,onKeyup:ue(G,[`enter`])},null,8,[`modelValue`,`placeholder`])])]),y(T(N),null,{default:C(()=>[y(T(u),{type:`button`,variant:`outline`,onClick:et},{default:C(()=>[v(D(T(b)(`common.cancel`)),1)]),_:1}),y(T(u),{type:`button`,onClick:G},{default:C(()=>[v(D(T(b)(`common.confirm`)),1)]),_:1})]),_:1})]),_:1})]),_:1},8,[`open`]),y(T(l),{open:K.value,"onUpdate:open":r[5]||=e=>K.value=e},{default:C(()=>[y(T(c),{class:`sm:max-w-md`},{default:C(()=>[y(T(o),null,{default:C(()=>[y(T(a),null,{default:C(()=>[v(D(T(b)(`home.editExpense`)),1)]),_:1}),y(T(s),null,{default:C(()=>[v(D(T(b)(`home.editExpenseDesc`)),1)]),_:1})]),_:1}),h(`div`,We,[h(`div`,Ge,[y(T(i),{for:`edit-title`},{default:C(()=>[v(D(T(b)(`home.title_`)),1)]),_:1}),y(T(A),{id:`edit-title`,modelValue:Y.value.title,"onUpdate:modelValue":r[2]||=e=>Y.value.title=e,placeholder:T(b)(`home.enterExpenseTitle`)},null,8,[`modelValue`,`placeholder`])]),h(`div`,Ke,[y(T(i),{for:`edit-amount`},{default:C(()=>[v(D(T(b)(`home.amount`)),1)]),_:1}),y(T(A),{id:`edit-amount`,modelValue:Y.value.amount,"onUpdate:modelValue":r[3]||=e=>Y.value.amount=e,type:`number`,min:`0`,step:`1`,placeholder:T(b)(`home.enterAmount`)},null,8,[`modelValue`,`placeholder`])]),h(`div`,qe,[y(T(i),null,{default:C(()=>[v(D(T(b)(`home.category`)),1)]),_:1}),h(`div`,Je,[(x(!0),_(p,null,S(J.value,e=>(x(),_(`button`,{key:e.id,type:`button`,onClick:t=>Y.value.category=e.id,class:E([`flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all duration-200`,Y.value.category===e.id?`border-brand-primary bg-brand-accent`:`border-border bg-background hover:border-brand-primary hover:bg-brand-accent`])},[h(`div`,{class:E([`flex h-10 w-10 items-center justify-center rounded-lg`,Y.value.category===e.id?`bg-brand-primary`:`bg-brand-accent`])},[(x(),g(de(e.icon),{class:E([`h-5 w-5`,Y.value.category===e.id?`text-brand-primary-foreground`:`text-brand-primary`])},null,8,[`class`]))],2),h(`span`,Xe,D(e.label),1)],10,Ye))),128))])]),h(`div`,Ze,[y(T(i),null,{default:C(()=>[v(D(T(b)(`home.date`)),1)]),_:1}),y(T(_e),null,{default:C(()=>[y(T(he),{asChild:``},{default:C(()=>[y(T(u),{variant:`outline`,class:`w-full justify-start text-left font-normal`},{default:C(()=>[y(T(oe),{class:`mr-2 h-4 w-4`}),v(` `+D(at(Y.value.date)),1)]),_:1})]),_:1}),y(T(ge),{class:`w-auto p-0`,align:`start`},{default:C(()=>[y(T(me),{modelValue:X.value,"onUpdate:modelValue":[r[4]||=e=>X.value=e,it]},null,8,[`modelValue`])]),_:1})]),_:1})])]),y(T(N),{class:`flex flex-col-reverse sm:flex-row sm:justify-between gap-3`},{default:C(()=>[y(T(u),{variant:`destructive`,onClick:ct,class:`w-full sm:w-auto`},{default:C(()=>[v(D(T(b)(`common.delete`)),1)]),_:1}),h(`div`,Qe,[y(T(u),{variant:`outline`,onClick:st,class:`w-full sm:w-auto`},{default:C(()=>[v(D(T(b)(`common.cancel`)),1)]),_:1}),y(T(u),{onClick:ot,class:`w-full sm:w-auto`},{default:C(()=>[v(D(T(b)(`common.save`)),1)]),_:1})])]),_:1})]),_:1})]),_:1},8,[`open`])]))}}),I=O(F,[[`__scopeId`,`data-v-f1d18990`]]);export{I as default};