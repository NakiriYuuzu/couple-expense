import{b as e}from"./trending-up-AORfcXSH.js";import{b as t}from"./Card-B_5NY5d-.js";import{b as n,c as r}from"./TopBar-Cegs0OHU.js";import{b as i}from"./Progress-BcOfro9_.js";import{J as a,a$ as o,a3 as s,aA as c,aB as l,aC as u,aE as d,aF as f,aG as p,aM as m,aP as h,aQ as g,aR as _,aT as v,aU as y,aV as b,aX as x,aY as S,a_ as C,aa as w,ac as T,ae as E,af as D,ag as O,ai as ee,al as te,am as k,aq as A,at as j,av as M,aw as N,ay as P,az as F,b5 as I,b9 as L,bb as R,bd as z,bg as B,i as ne,k as re,m as V,n as ie,v as H,x as U}from"./index-Dkwm6DWF.js";import{b as W}from"./CardContent-BWSex-LG.js";import{b as G,c as K}from"./usePullToRefresh-Bx0xemPJ.js";const q=A(`trending-down`,[[`path`,{d:`M16 17h6v-6`,key:`t6n2it`}],[`path`,{d:`m22 17-8.5-8.5-5 5L2 7`,key:`x473p`}]]),[J,Y]=w(`AvatarRoot`);var X=p({__name:`AvatarRoot`,props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:`span`}},setup(e){return r(),Y({imageLoadingStatus:I(`idle`)}),(e,t)=>(_(),c(R(a),{"as-child":e.asChild,as:e.as},{default:C(()=>[y(e.$slots,`default`)]),_:3},8,[`as-child`,`as`]))}}),Z=X,ae=p({__name:`AvatarFallback`,props:{delayMs:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:`span`}},setup(e){let t=e,n=J();r();let i=I(t.delayMs===void 0);return S(e=>{if(t.delayMs&&s){let n=window.setTimeout(()=>{i.value=!0},t.delayMs);e(()=>{window.clearTimeout(n)})}}),(e,t)=>i.value&&R(n).imageLoadingStatus.value!==`loaded`?(_(),c(R(a),{key:0,"as-child":e.asChild,as:e.as},{default:C(()=>[y(e.$slots,`default`)]),_:3},8,[`as-child`,`as`])):l(`v-if`,!0)}}),oe=ae;function Q(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?`loaded`:`loading`):`error`:`idle`}function se(e,{referrerPolicy:t,crossOrigin:n}={}){let r=I(!1),i=I(null),a=P(()=>r.value?(!i.value&&s&&(i.value=new window.Image),i.value):null),o=I(Q(a.value,e.value)),c=e=>()=>{r.value&&(o.value=e)};return h(()=>{r.value=!0,S(r=>{let i=a.value;if(!i)return;o.value=Q(i,e.value);let s=c(`loaded`),l=c(`error`);i.addEventListener(`load`,s),i.addEventListener(`error`,l),t?.value&&(i.referrerPolicy=t.value),typeof n?.value==`string`&&(i.crossOrigin=n.value),r(()=>{i.removeEventListener(`load`,s),i.removeEventListener(`error`,l)})})}),g(()=>{r.value=!1}),o}var ce=p({__name:`AvatarImage`,props:{src:{type:String,required:!0},referrerPolicy:{type:null,required:!1},crossOrigin:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:`img`}},emits:[`loadingStatusChange`],setup(e,{emit:t}){let n=e,i=t,{src:s,referrerPolicy:l,crossOrigin:u}=L(n);r();let d=J(),f=se(s,{referrerPolicy:l,crossOrigin:u});return x(f,e=>{i(`loadingStatusChange`,e),e!==`idle`&&(d.imageLoadingStatus.value=e)},{immediate:!0}),(e,t)=>o((_(),c(R(a),{role:`img`,"as-child":e.asChild,as:e.as,src:R(s),"referrer-policy":R(l)},{default:C(()=>[y(e.$slots,`default`)]),_:3},8,[`as-child`,`as`,`src`,`referrer-policy`])),[[j,R(f)===`loaded`]])}}),le=ce,ue=p({__name:`Avatar`,props:{class:{}},setup(e){let t=e;return(e,n)=>(_(),c(R(Z),{"data-slot":`avatar`,class:z(R(D)(`relative flex size-8 shrink-0 overflow-hidden rounded-full`,t.class))},{default:C(()=>[y(e.$slots,`default`)]),_:3},8,[`class`]))}}),de=ue,fe=p({__name:`AvatarFallback`,props:{delayMs:{},asChild:{type:Boolean},as:{},class:{}},setup(e){let t=e,n=H(t,`class`);return(e,r)=>(_(),c(R(oe),m({"data-slot":`avatar-fallback`},R(n),{class:R(D)(`bg-muted flex size-full items-center justify-center rounded-full`,t.class)}),{default:C(()=>[y(e.$slots,`default`)]),_:3},16,[`class`]))}}),pe=fe,me=p({__name:`AvatarImage`,props:{src:{},referrerPolicy:{},crossOrigin:{},asChild:{type:Boolean},as:{}},setup(e){let t=e;return(e,n)=>(_(),c(R(le),m({"data-slot":`avatar-image`},t,{class:`aspect-square size-full`}),{default:C(()=>[y(e.$slots,`default`)]),_:3},16))}}),he=me;const ge={class:`min-h-screen bg-background`},_e={class:`px-4 pb-24`},ve={class:`mt-6 animate-slide-in-left`},ye={class:`flex items-center gap-2 mb-4`},be={class:`flex h-8 w-8 items-center justify-center rounded-lg bg-brand-accent`},xe={class:`text-lg font-semibold text-foreground`},Se={class:`grid grid-cols-2 gap-4`},Ce={class:`text-sm text-muted-foreground`},we={class:`text-2xl font-bold text-foreground`},Te={class:`text-sm text-muted-foreground`},Ee={class:`text-xl font-semibold text-foreground`},De={key:0,class:`mt-4 pt-4 border-t border-border`},Oe={class:`text-sm font-medium text-muted-foreground mb-3`},ke={class:`space-y-2`},Ae={key:1,class:`mt-4 pt-4 border-t border-border text-center py-6`},je={class:`text-sm text-muted-foreground`},Me={key:2,class:`mt-4 pt-4 border-t border-border`},Ne={class:`flex items-center justify-between mb-2`},Pe={class:`flex items-center gap-2`},Fe={class:`text-sm text-muted-foreground`},Ie={class:`flex justify-between text-xs text-muted-foreground mt-1`},Le={key:0,class:`mt-6 animate-slide-in-right`},Re={class:`flex items-center gap-2 mb-4`},ze={class:`flex h-8 w-8 items-center justify-center rounded-lg bg-brand-accent`},Be={class:`text-lg font-semibold text-foreground`},Ve={class:`grid grid-cols-2 gap-4`},He={class:`text-sm text-muted-foreground`},Ue={class:`text-2xl font-bold text-foreground`},We={class:`text-sm text-muted-foreground`},Ge={class:`text-xl font-semibold text-foreground`},Ke={key:0,class:`mt-4 pt-4 border-t border-border`},qe={class:`text-sm font-medium text-muted-foreground mb-3`},Je={class:`space-y-3`},$={class:`flex-1`},Ye={class:`flex items-center justify-between mb-1`},Xe={class:`text-sm font-medium`},Ze={class:`text-sm text-muted-foreground`},Qe={key:1,class:`mt-4 pt-4 border-t border-border`},$e={class:`text-sm font-medium text-muted-foreground mb-3`},et={class:`space-y-2`},tt={key:2,class:`mt-4 pt-4 border-t border-border text-center py-6`},nt={class:`text-sm text-muted-foreground`};var rt=p({__name:`Dashboard`,setup(r){let{t:a}=T(),o=E(),s=ne(),p=re(),{personalExpenses:h,familyExpenses:g,personalStats:y,familyStats:x,spendingRatio:S}=V(s),{isInCouple:w,coupleSettings:D,userProfile:A,partnerProfile:j,personalBudget:I}=V(p),L=P(()=>[...h.value].sort((e,t)=>t.date.localeCompare(e.date)).slice(0,3)),H=P(()=>[...g.value].sort((e,t)=>t.date.localeCompare(e.date)).slice(0,3)),J=e=>`NT$ ${Math.round(e).toLocaleString()}`;P(()=>D.value?.monthly_budget?Math.min(100,Math.round(x.value.month/D.value.monthly_budget*100)):0);let Y=P(()=>!I.value||I.value<=0?0:Math.min(100,Math.round(y.value.month/I.value*100))),X=e=>({id:e.id,title:e.title,amount:`NT ${Math.round(e.amount)}`,category:e.category,icon:ie.getIconKey(e.category),user:e.user}),Z=e=>{o.push({name:`Expenses`,query:{tab:e}})};return G({onRefresh:async()=>{try{await Promise.all([s.fetchExpenses(),p.fetchUserProfile()]),O.success(a(`common.refreshed`))}catch(e){console.error(`刷新失敗:`,e),O.error(a(`common.refreshFailed`))}}}),(r,o)=>(_(),u(`div`,ge,[f(n,{title:R(a)(`nav.dashboard`)},null,8,[`title`]),F(`main`,_e,[F(`section`,ve,[F(`div`,ye,[F(`div`,be,[f(R(ee),{class:`h-4 w-4 text-brand-primary`})]),F(`h2`,xe,B(R(a)(`dashboard.personal`)),1)]),f(R(t),{class:`border-0 shadow-md py-0 pt-2`},{default:C(()=>[f(R(W),{class:`p-4`},{default:C(()=>[F(`div`,Se,[F(`div`,null,[F(`p`,Ce,B(R(a)(`dashboard.monthTotal`)),1),F(`p`,we,B(J(R(y).month)),1)]),F(`div`,null,[F(`p`,Te,B(R(a)(`dashboard.todayTotal`)),1),F(`p`,Ee,B(J(R(y).today)),1)])]),L.value.length>0?(_(),u(`div`,De,[F(`p`,Oe,B(R(a)(`dashboard.recentExpenses`)),1),F(`div`,ke,[(_(!0),u(N,null,v(L.value,e=>(_(),c(K,m({key:e.id},{ref_for:!0},X(e),{"show-user":!1,class:`py-2`}),null,16))),128))])])):(_(),u(`div`,Ae,[F(`p`,je,B(R(a)(`dashboard.noPersonalExpenses`)),1)])),R(I)?(_(),u(`div`,Me,[F(`div`,Ne,[F(`div`,Pe,[(_(),c(b(Y.value>=100?R(q):R(e)),{class:z([`h-4 w-4`,Y.value>=100?`text-red-500`:Y.value>=80?`text-yellow-500`:`text-brand-primary`])},null,8,[`class`])),F(`span`,Fe,B(R(a)(`dashboard.personalBudgetProgress`)),1)]),F(`span`,{class:z([`text-sm font-semibold`,Y.value>=100?`text-red-500`:Y.value>=80?`text-yellow-500`:`text-brand-primary`])},B(Y.value)+`% `,3)]),f(R(i),{"model-value":Y.value,class:z([`h-2`,Y.value>=100?`[&>div]:bg-red-500`:Y.value>=80?`[&>div]:bg-yellow-500`:``])},null,8,[`model-value`,`class`]),F(`div`,Ie,[F(`span`,null,B(J(R(y).month)),1),F(`span`,null,B(J(R(I))),1)])])):l(``,!0),f(R(U),{type:`button`,variant:`ghost`,class:`w-full mt-4 text-brand-primary hover:text-brand-primary hover:bg-brand-accent`,onClick:o[0]||=M(e=>Z(`personal`),[`stop`])},{default:C(()=>[d(B(R(a)(`dashboard.viewMore`))+` `,1),f(R(k),{class:`h-4 w-4 ml-1`})]),_:1})]),_:1})]),_:1})]),R(w)?(_(),u(`section`,Le,[F(`div`,Re,[F(`div`,ze,[f(R(te),{class:`h-4 w-4 text-brand-primary`})]),F(`h2`,Be,B(R(a)(`dashboard.family`)),1)]),f(R(t),{class:`border-0 shadow-md py-0 pt-2`},{default:C(()=>[f(R(W),{class:`p-4`},{default:C(()=>[F(`div`,Ve,[F(`div`,null,[F(`p`,He,B(R(a)(`dashboard.monthTotal`)),1),F(`p`,Ue,B(J(R(x).month)),1)]),F(`div`,null,[F(`p`,We,B(R(a)(`dashboard.todayTotal`)),1),F(`p`,Ge,B(J(R(x).today)),1)])]),R(S)&&Object.keys(R(S)).length===2?(_(),u(`div`,Ke,[F(`p`,qe,B(R(a)(`dashboard.spendingRatio`)),1),F(`div`,Je,[(_(!0),u(N,null,v(R(S),(e,t)=>(_(),u(`div`,{key:t,class:`flex items-center gap-3`},[f(R(de),{class:`h-8 w-8`},{default:C(()=>[f(R(he),{src:e.user?.avatar_url||``},null,8,[`src`]),f(R(pe),{class:`bg-brand-accent text-brand-primary text-xs`},{default:C(()=>[d(B(e.user?.display_name?.charAt(0)||`?`),1)]),_:2},1024)]),_:2},1024),F(`div`,$,[F(`div`,Ye,[F(`span`,Xe,B(e.user?.display_name||R(a)(`common.unknown`)),1),F(`span`,Ze,B(e.percentage)+`%`,1)]),f(R(i),{"model-value":e.percentage,class:`h-2`},null,8,[`model-value`])])]))),128))])])):l(``,!0),H.value.length>0?(_(),u(`div`,Qe,[F(`p`,$e,B(R(a)(`dashboard.recentExpenses`)),1),F(`div`,et,[(_(!0),u(N,null,v(H.value,e=>(_(),c(K,m({key:e.id},{ref_for:!0},X(e),{"show-user":!0,class:`py-2`}),null,16))),128))])])):(_(),u(`div`,tt,[F(`p`,nt,B(R(a)(`dashboard.noFamilyExpenses`)),1)])),f(R(U),{type:`button`,variant:`ghost`,class:`w-full mt-4 text-brand-primary hover:text-brand-primary hover:bg-brand-accent`,onClick:o[1]||=M(e=>Z(`family`),[`stop`])},{default:C(()=>[d(B(R(a)(`dashboard.viewMore`))+` `,1),f(R(k),{class:`h-4 w-4 ml-1`})]),_:1})]),_:1})]),_:1})])):l(``,!0)])]))}}),it=rt;export{it as default};