import{b as e,c as t,d as n,e as r,f as ee}from"./SelectValue-BoBfgLwg.js";import{b as te,c as ne,d as i}from"./badge-DZxBum43.js";import"./PopperContent-BnGMTRB6.js";import{b as a}from"./Card-B_5NY5d-.js";import{b as o}from"./TopBar-Cegs0OHU.js";import{b as s}from"./Label-BbU9RIJx.js";import{aA as re,aB as c,aC as l,aE as u,aF as d,aG as f,aP as p,aR as m,aT as h,aX as ie,a_ as g,ac as ae,ae as _,ag as v,aj as y,ak as b,aq as x,aw as S,ay as oe,az as C,b4 as se,b5 as w,bb as T,bg as E,c as D,k as O,q as k,x as A}from"./index-Dkwm6DWF.js";const j=x(`copy`,[[`rect`,{width:`14`,height:`14`,x:`8`,y:`8`,rx:`2`,ry:`2`,key:`17jyea`}],[`path`,{d:`M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2`,key:`zix9uf`}]]),M=x(`dollar-sign`,[[`line`,{x1:`12`,x2:`12`,y1:`2`,y2:`22`,key:`7eqyqh`}],[`path`,{d:`M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6`,key:`1b0p4s`}]]),N=x(`heart`,[[`path`,{d:`M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5`,key:`mvr1a0`}]]),P=x(`save`,[[`path`,{d:`M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z`,key:`1c8476`}],[`path`,{d:`M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7`,key:`1ydtos`}],[`path`,{d:`M7 3v4a1 1 0 0 0 1 1h7`,key:`t51u73`}]]),F=x(`user-plus`,[[`path`,{d:`M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2`,key:`1yyitq`}],[`circle`,{cx:`9`,cy:`7`,r:`4`,key:`nufk8`}],[`line`,{x1:`19`,x2:`19`,y1:`8`,y2:`14`,key:`1bvyxn`}],[`line`,{x1:`22`,x2:`16`,y1:`11`,y2:`11`,key:`1shjgl`}]]),I=x(`users`,[[`path`,{d:`M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2`,key:`1yyitq`}],[`path`,{d:`M16 3.128a4 4 0 0 1 0 7.744`,key:`16gr8j`}],[`path`,{d:`M22 21v-2a4 4 0 0 0-3-3.87`,key:`kshegd`}],[`circle`,{cx:`9`,cy:`7`,r:`4`,key:`nufk8`}]]),L={class:`couple-management p-6 max-w-2xl mx-auto space-y-6`},R={key:0,class:`flex items-center justify-center py-8`},z={key:1,class:`bg-red-50 border border-red-200 rounded-lg p-4 mb-4`},B={class:`flex`},V={class:`text-sm font-medium text-red-800`},H={class:`text-sm text-red-700 mt-1`},U={key:2,class:`space-y-6`},W={class:`text-center`},G={class:`text-2xl font-bold text-gray-900 mb-2`},K={class:`text-gray-600`},ce={class:`grid grid-cols-1 md:grid-cols-2 gap-4`},le={class:`text-center space-y-4`},ue={class:`text-lg font-semibold`},de={class:`text-sm text-gray-600`},fe={class:`space-y-3`},pe={class:`text-center space-y-4`},me={class:`text-lg font-semibold`},he={class:`text-sm text-gray-600`},ge={class:`space-y-3`},_e={key:3,class:`space-y-6`},ve={class:`flex items-center justify-between mb-4`},ye={class:`text-xl font-bold flex items-center`},be={class:`grid grid-cols-1 md:grid-cols-2 gap-4`},xe={class:`space-y-2`},Se={class:`flex items-center space-x-2`},Ce={class:`text-xs text-gray-500`},we={class:`space-y-2`},Te={key:0,class:`flex items-center space-x-2`},Ee={class:`text-sm`},De={key:1,class:`flex items-center space-x-2`},Oe={class:`text-sm text-gray-500`},ke={class:`text-lg font-semibold mb-4 flex items-center`},Ae={class:`space-y-4`},je={class:`grid grid-cols-1 md:grid-cols-2 gap-4`},Me={class:`space-y-2`},Ne={class:`flex items-center space-x-2`},Pe={class:`text-sm text-gray-500`},Fe={class:`space-y-2`},Ie={class:`space-y-3`},Le={class:`grid grid-cols-2 md:grid-cols-3 gap-3`},Re={class:`text-xs text-gray-500`},ze={class:`flex justify-end space-x-2`},Be={class:`text-lg font-semibold mb-4 text-red-600 flex items-center`},Ve={class:`space-y-4`},He={class:`bg-red-50 p-4 rounded-lg`},Ue={class:`text-sm text-red-700 mb-3`},We={class:`text-xs text-red-600 space-y-1 ml-4`};var q=f({__name:`CoupleManagement`,setup(o){let f=O(),{t:_}=ae(),x=oe(()=>{let e=f.couple?.invitation_code;return e||``}),D=w(`我們的家庭`),q=w(``),J=w(5e4),Y=w(`1`),X=se({food:15e3,transport:8e3,shopping:1e4,home:8e3,pet:5e3,other:4e3}),Z=e=>{let t=`expense.categories.${e}`;return _(t)},Q=async()=>{try{let e=await f.createCouple(D.value);v.success(_(`couple.createSuccess`,{code:e}))}catch{v.error(_(`couple.createError`))}},$=async()=>{try{await f.joinCouple(q.value.trim()),v.success(_(`couple.joinSuccess`)),q.value=``}catch{v.error(_(`couple.joinError`))}},Ge=async()=>{try{await navigator.clipboard.writeText(f.couple?.invitation_code||``),v.success(_(`couple.copySuccess`))}catch{v.error(_(`couple.copyError`))}},Ke=async()=>{try{await f.updateCoupleSettings({monthly_budget:J.value,budget_start_day:parseInt(Y.value),category_budgets:{...X}}),v.success(_(`couple.saveSuccess`))}catch{v.error(_(`couple.saveError`))}},qe=()=>{let e=f.coupleSettings;if(e){J.value=e.monthly_budget,Y.value=e.budget_start_day.toString();let t=e,n=t.category_budgets;n&&typeof n==`object`&&Object.assign(X,n)}},Je=async()=>{if(confirm(_(`couple.confirmLeave`)))try{await f.leaveCouple(),v.success(_(`couple.leaveSuccess`))}catch{v.error(_(`couple.leaveError`))}};return ie(()=>f.coupleSettings,e=>{if(e){J.value=e.monthly_budget,Y.value=e.budget_start_day.toString();let t=e,n=t.category_budgets;n&&typeof n==`object`&&Object.assign(X,n)}},{immediate:!0}),p(async()=>{try{await f.fetchUserProfile()}catch(e){console.error(`獲取用戶資料失敗:`,e)}}),(o,p)=>(m(),l(`div`,L,[T(f).loading?(m(),l(`div`,R,[...p[4]||=[C(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-[#9747FF]`},null,-1)]])):c(``,!0),T(f).error?(m(),l(`div`,z,[C(`div`,B,[d(T(i),{class:`h-5 w-5 text-red-400 mr-2 flex-shrink-0 mt-0.5`}),C(`div`,null,[C(`h3`,V,E(T(_)(`couple.error`)),1),C(`p`,H,E(T(f).error),1),d(T(A),{onClick:T(f).clearError,variant:`outline`,size:`sm`,class:`mt-2`},{default:g(()=>[u(E(T(_)(`couple.clearError`)),1)]),_:1},8,[`onClick`])])])])):c(``,!0),T(f).isInCouple?(m(),l(`div`,_e,[d(T(a),{class:`p-6`},{default:g(()=>[C(`div`,ve,[C(`h2`,ye,[d(T(N),{class:`h-6 w-6 text-red-500 mr-2`}),u(` `+E(T(f).couple?.name),1)]),T(f).isOwner?(m(),re(T(te),{key:0,variant:`secondary`},{default:g(()=>[u(E(T(_)(`couple.admin`)),1)]),_:1})):c(``,!0)]),C(`div`,be,[C(`div`,xe,[d(T(s),null,{default:g(()=>[u(E(T(_)(`couple.invitationCode`)),1)]),_:1}),C(`div`,Se,[d(T(k),{"model-value":x.value,readonly:``,class:`font-mono`,placeholder:x.value?``:T(_)(`couple.loading`)},null,8,[`model-value`,`placeholder`]),d(T(A),{onClick:Ge,variant:`outline`,size:`sm`},{default:g(()=>[d(T(j),{class:`h-4 w-4`})]),_:1})]),C(`p`,Ce,E(T(_)(`couple.shareCode`)),1)]),C(`div`,we,[d(T(s),null,{default:g(()=>[u(E(T(_)(`couple.partnerStatus`)),1)]),_:1}),T(f).hasPartner?(m(),l(`div`,Te,[p[5]||=C(`div`,{class:`h-2 w-2 bg-green-500 rounded-full`},null,-1),C(`span`,Ee,E(T(f).partnerProfile?.display_name||T(_)(`couple.joined`)),1)])):(m(),l(`div`,De,[p[6]||=C(`div`,{class:`h-2 w-2 bg-gray-400 rounded-full`},null,-1),C(`span`,Oe,E(T(_)(`couple.waitingForPartner`)),1)]))])])]),_:1}),d(T(a),{class:`p-6`},{default:g(()=>[C(`h3`,ke,[d(T(M),{class:`h-5 w-5 mr-2`}),u(` `+E(T(_)(`couple.budgetSettings`)),1)]),C(`div`,Ae,[C(`div`,je,[C(`div`,Me,[d(T(s),null,{default:g(()=>[u(E(T(_)(`couple.monthlyBudget`)),1)]),_:1}),C(`div`,Ne,[d(T(k),{modelValue:J.value,"onUpdate:modelValue":p[2]||=e=>J.value=e,modelModifiers:{number:!0},type:`number`,min:`0`,step:`100`,class:`flex-1`},null,8,[`modelValue`]),C(`span`,Pe,E(T(f).coupleSettings?.currency||`TWD`),1)])]),C(`div`,Fe,[d(T(s),null,{default:g(()=>[u(E(T(_)(`couple.budgetStartDay`)),1)]),_:1}),d(T(ee),{modelValue:Y.value,"onUpdate:modelValue":p[3]||=e=>Y.value=e},{default:g(()=>[d(T(t),null,{default:g(()=>[d(T(e),{placeholder:T(_)(`couple.selectDate`)},null,8,[`placeholder`])]),_:1}),d(T(r),null,{default:g(()=>[(m(),l(S,null,h(28,e=>d(T(n),{key:e,value:e.toString()},{default:g(()=>[u(E(T(_)(`couple.dayOfMonth`,{day:e})),1)]),_:2},1032,[`value`])),64))]),_:1})]),_:1},8,[`modelValue`])])]),C(`div`,Ie,[d(T(s),null,{default:g(()=>[u(E(T(_)(`couple.categoryBudgetAllocation`)),1)]),_:1}),C(`div`,Le,[(m(!0),l(S,null,h(X,(e,t)=>(m(),l(`div`,{key:t,class:`space-y-1`},[d(T(s),{class:`text-sm capitalize`},{default:g(()=>[u(E(Z(t)),1)]),_:2},1024),d(T(k),{modelValue:X[t],"onUpdate:modelValue":e=>X[t]=e,modelModifiers:{number:!0},type:`number`,min:`0`,step:`100`,class:`text-sm`},null,8,[`modelValue`,`onUpdate:modelValue`])]))),128))]),C(`div`,Re,E(T(_)(`couple.total`))+`: `+E(Object.values(X).reduce((e,t)=>e+(t||0),0))+` `+E(T(f).coupleSettings?.currency||`TWD`),1)]),C(`div`,ze,[d(T(A),{onClick:qe,variant:`outline`},{default:g(()=>[u(E(T(_)(`couple.reset`)),1)]),_:1}),d(T(A),{onClick:Ke,disabled:T(f).loading},{default:g(()=>[d(T(P),{class:`h-4 w-4 mr-2`}),u(` `+E(T(_)(`couple.saveSettings`)),1)]),_:1},8,[`disabled`])])])]),_:1}),d(T(a),{class:`p-6 border-red-200`},{default:g(()=>[C(`h3`,Be,[d(T(y),{class:`h-5 w-5 mr-2`}),u(` `+E(T(_)(`couple.dangerZone`)),1)]),C(`div`,Ve,[C(`div`,He,[C(`p`,Ue,E(T(_)(`couple.leaveWarning`)),1),C(`ul`,We,[C(`li`,null,`• `+E(T(_)(`couple.leaveWarning1`)),1),C(`li`,null,`• `+E(T(_)(`couple.leaveWarning2`)),1),C(`li`,null,`• `+E(T(_)(`couple.leaveWarning3`)),1)])]),d(T(A),{onClick:Je,variant:`destructive`,disabled:T(f).loading},{default:g(()=>[d(T(ne),{class:`h-4 w-4 mr-2`}),u(` `+E(T(_)(`couple.leaveCouple`)),1)]),_:1},8,[`disabled`])])]),_:1})])):(m(),l(`div`,U,[C(`div`,W,[d(T(N),{class:`h-16 w-16 text-[#9747FF] mx-auto mb-4`}),C(`h2`,G,E(T(_)(`couple.createOrJoin`)),1),C(`p`,K,E(T(_)(`couple.manageSharedExpenses`)),1)]),C(`div`,ce,[d(T(a),{class:`p-6`},{default:g(()=>[C(`div`,le,[d(T(I),{class:`h-12 w-12 text-[#9747FF] mx-auto`}),C(`h3`,ue,E(T(_)(`couple.createNew`)),1),C(`p`,de,E(T(_)(`couple.createDesc`)),1),C(`div`,fe,[d(T(k),{modelValue:D.value,"onUpdate:modelValue":p[0]||=e=>D.value=e,placeholder:T(_)(`couple.coupleNamePlaceholder`),class:`w-full`},null,8,[`modelValue`,`placeholder`]),d(T(A),{onClick:Q,disabled:T(f).loading,class:`w-full`},{default:g(()=>[d(T(b),{class:`h-4 w-4 mr-2`}),u(` `+E(T(_)(`couple.create`)),1)]),_:1},8,[`disabled`])])])]),_:1}),d(T(a),{class:`p-6`},{default:g(()=>[C(`div`,pe,[d(T(F),{class:`h-12 w-12 text-[#9747FF] mx-auto`}),C(`h3`,me,E(T(_)(`couple.join`)),1),C(`p`,he,E(T(_)(`couple.joinDesc`)),1),C(`div`,ge,[d(T(k),{modelValue:q.value,"onUpdate:modelValue":p[1]||=e=>q.value=e,placeholder:T(_)(`couple.invitationCodePlaceholder`),class:`w-full`,maxlength:`8`},null,8,[`modelValue`,`placeholder`]),d(T(A),{onClick:$,disabled:T(f).loading||!q.value,class:`w-full`},{default:g(()=>[d(T(F),{class:`h-4 w-4 mr-2`}),u(` `+E(T(_)(`couple.joinButton`)),1)]),_:1},8,[`disabled`])])])]),_:1})])]))]))}}),J=D(q,[[`__scopeId`,`data-v-19ac0ab9`]]);const Y={class:`min-h-screen bg-background`},X={class:`px-4 pb-20`},Z={class:`mt-6`};var Q=f({__name:`CoupleSettings`,setup(e){let t=_(),n=()=>{t.back()};return(e,t)=>(m(),l(`div`,Y,[d(o,{title:e.$t(`couple.title`),"show-back-button":!0,onBack:n},null,8,[`title`]),C(`main`,X,[C(`div`,Z,[d(J)])])]))}}),$=Q;export{$ as default};