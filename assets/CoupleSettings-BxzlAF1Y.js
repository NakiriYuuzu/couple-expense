import{b as e,c as t,d as n,e as ee,f as r}from"./SelectValue-Bo5Shl6q.js";import"./VisuallyHidden-BPF3JLnY.js";import{b as te}from"./TopBar-DUw4tseo.js";import{b as i}from"./Label-CwhSjOJt.js";import{b as a,c as o,d as s}from"./badge-DKtIHcPq.js";import{D as c,H as ne,P as l,Q as u,a$ as d,aS as f,aT as p,aW as m,aY as re,aZ as h,a_ as ie,b0 as g,b2 as _,b3 as v,b4 as y,bc as b,be as x,bg as S,bk as ae,bm as C,bq as oe,br as w,bv as T,bz as E,c as D,j as se,x as O}from"./index-DaV3G9Q-.js";import{b as k}from"./Card-BpQYwhaM.js";const A=l(`copy`,[[`rect`,{width:`14`,height:`14`,x:`8`,y:`8`,rx:`2`,ry:`2`,key:`17jyea`}],[`path`,{d:`M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2`,key:`zix9uf`}]]),j=l(`dollar-sign`,[[`line`,{x1:`12`,x2:`12`,y1:`2`,y2:`22`,key:`7eqyqh`}],[`path`,{d:`M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6`,key:`1b0p4s`}]]),M=l(`heart`,[[`path`,{d:`M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5`,key:`mvr1a0`}]]),N=l(`save`,[[`path`,{d:`M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z`,key:`1c8476`}],[`path`,{d:`M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7`,key:`1ydtos`}],[`path`,{d:`M7 3v4a1 1 0 0 0 1 1h7`,key:`t51u73`}]]),P=l(`triangle-alert`,[[`path`,{d:`m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3`,key:`wmoenq`}],[`path`,{d:`M12 9v4`,key:`juzpu7`}],[`path`,{d:`M12 17h.01`,key:`p32p05`}]]),F=l(`user-plus`,[[`path`,{d:`M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2`,key:`1yyitq`}],[`circle`,{cx:`9`,cy:`7`,r:`4`,key:`nufk8`}],[`line`,{x1:`19`,x2:`19`,y1:`8`,y2:`14`,key:`1bvyxn`}],[`line`,{x1:`22`,x2:`16`,y1:`11`,y2:`11`,key:`1shjgl`}]]),I=l(`users`,[[`path`,{d:`M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2`,key:`1yyitq`}],[`path`,{d:`M16 3.128a4 4 0 0 1 0 7.744`,key:`16gr8j`}],[`path`,{d:`M22 21v-2a4 4 0 0 0-3-3.87`,key:`kshegd`}],[`circle`,{cx:`9`,cy:`7`,r:`4`,key:`nufk8`}]]),L={class:`couple-management p-6 max-w-2xl mx-auto space-y-6`},R={key:0,class:`flex items-center justify-center py-8`},z={key:1,class:`bg-red-50 border border-red-200 rounded-lg p-4 mb-4`},B={class:`flex`},V={class:`text-sm font-medium text-red-800`},H={class:`text-sm text-red-700 mt-1`},U={key:2,class:`space-y-6`},W={class:`text-center`},G={class:`text-2xl font-bold text-gray-900 mb-2`},K={class:`text-gray-600`},ce={class:`grid grid-cols-1 md:grid-cols-2 gap-4`},le={class:`text-center space-y-4`},ue={class:`text-lg font-semibold`},de={class:`text-sm text-gray-600`},fe={class:`space-y-3`},pe={class:`text-center space-y-4`},me={class:`text-lg font-semibold`},he={class:`text-sm text-gray-600`},ge={class:`space-y-3`},_e={key:3,class:`space-y-6`},ve={class:`flex items-center justify-between mb-4`},ye={class:`text-xl font-bold flex items-center`},be={class:`grid grid-cols-1 md:grid-cols-2 gap-4`},xe={class:`space-y-2`},Se={class:`flex items-center space-x-2`},Ce={class:`text-xs text-gray-500`},we={class:`space-y-2`},Te={key:0,class:`flex items-center space-x-2`},Ee={class:`text-sm`},De={key:1,class:`flex items-center space-x-2`},Oe={class:`text-sm text-gray-500`},ke={class:`text-lg font-semibold mb-4 flex items-center`},Ae={class:`space-y-4`},je={class:`grid grid-cols-1 md:grid-cols-2 gap-4`},Me={class:`space-y-2`},Ne={class:`flex items-center space-x-2`},Pe={class:`text-sm text-gray-500`},Fe={class:`space-y-2`},Ie={class:`space-y-3`},Le={class:`grid grid-cols-2 md:grid-cols-3 gap-3`},Re={class:`text-xs text-gray-500`},ze={class:`flex justify-end space-x-2`},Be={class:`text-lg font-semibold mb-4 text-red-600 flex items-center`},Ve={class:`space-y-4`},He={class:`bg-red-50 p-4 rounded-lg`},Ue={class:`text-sm text-red-700 mb-3`},We={class:`text-xs text-red-600 space-y-1 ml-4`};var q=y({__name:`CoupleManagement`,setup(te){let l=se(),{t:f}=c(),y=re(()=>{let e=l.couple?.invitation_code;return e||``}),D=w(`我們的家庭`),q=w(``),J=w(5e4),Y=w(`1`),X=oe({food:15e3,transport:8e3,shopping:1e4,home:8e3,pet:5e3,other:4e3}),Z=e=>{let t=`expense.categories.${e}`;return f(t)},Q=async()=>{try{let e=await l.createCouple(D.value);p.success(f(`couple.createSuccess`,{code:e}))}catch{p.error(f(`couple.createError`))}},$=async()=>{try{await l.joinCouple(q.value.trim()),p.success(f(`couple.joinSuccess`)),q.value=``}catch{p.error(f(`couple.joinError`))}},Ge=async()=>{try{await navigator.clipboard.writeText(l.couple?.invitation_code||``),p.success(f(`couple.copySuccess`))}catch{p.error(f(`couple.copyError`))}},Ke=async()=>{try{await l.updateCoupleSettings({monthly_budget:J.value,budget_start_day:parseInt(Y.value),category_budgets:{...X}}),p.success(f(`couple.saveSuccess`))}catch{p.error(f(`couple.saveError`))}},qe=()=>{let e=l.coupleSettings;if(e){J.value=e.monthly_budget,Y.value=e.budget_start_day.toString();let t=e,n=t.category_budgets;n&&typeof n==`object`&&Object.assign(X,n)}},Je=async()=>{if(confirm(f(`couple.confirmLeave`)))try{await l.leaveCouple(),p.success(f(`couple.leaveSuccess`))}catch{p.error(f(`couple.leaveError`))}};return ae(()=>l.coupleSettings,e=>{if(e){J.value=e.monthly_budget,Y.value=e.budget_start_day.toString();let t=e,n=t.category_budgets;n&&typeof n==`object`&&Object.assign(X,n)}},{immediate:!0}),b(async()=>{try{await l.fetchUserProfile()}catch(e){console.error(`獲取用戶資料失敗:`,e)}}),(te,c)=>(x(),g(`div`,L,[T(l).loading?(x(),g(`div`,R,c[4]||=[h(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-[#9747FF]`},null,-1)])):d(``,!0),T(l).error?(x(),g(`div`,z,[h(`div`,B,[v(T(s),{class:`h-5 w-5 text-red-400 mr-2 flex-shrink-0 mt-0.5`}),h(`div`,null,[h(`h3`,V,E(T(f)(`couple.error`)),1),h(`p`,H,E(T(l).error),1),v(T(u),{onClick:T(l).clearError,variant:`outline`,size:`sm`,class:`mt-2`},{default:C(()=>[_(E(T(f)(`couple.clearError`)),1)]),_:1},8,[`onClick`])])])])):d(``,!0),T(l).isInCouple?(x(),g(`div`,_e,[v(T(k),{class:`p-6`},{default:C(()=>[h(`div`,ve,[h(`h2`,ye,[v(T(M),{class:`h-6 w-6 text-red-500 mr-2`}),_(` `+E(T(l).couple?.name),1)]),T(l).isOwner?(x(),ie(T(a),{key:0,variant:`secondary`},{default:C(()=>[_(E(T(f)(`couple.admin`)),1)]),_:1})):d(``,!0)]),h(`div`,be,[h(`div`,xe,[v(T(i),null,{default:C(()=>[_(E(T(f)(`couple.invitationCode`)),1)]),_:1}),h(`div`,Se,[v(T(O),{"model-value":y.value,readonly:``,class:`font-mono`,placeholder:y.value?``:T(f)(`couple.loading`)},null,8,[`model-value`,`placeholder`]),v(T(u),{onClick:Ge,variant:`outline`,size:`sm`},{default:C(()=>[v(T(A),{class:`h-4 w-4`})]),_:1})]),h(`p`,Ce,E(T(f)(`couple.shareCode`)),1)]),h(`div`,we,[v(T(i),null,{default:C(()=>[_(E(T(f)(`couple.partnerStatus`)),1)]),_:1}),T(l).hasPartner?(x(),g(`div`,Te,[c[5]||=h(`div`,{class:`h-2 w-2 bg-green-500 rounded-full`},null,-1),h(`span`,Ee,E(T(l).partnerProfile?.display_name||T(f)(`couple.joined`)),1)])):(x(),g(`div`,De,[c[6]||=h(`div`,{class:`h-2 w-2 bg-gray-400 rounded-full`},null,-1),h(`span`,Oe,E(T(f)(`couple.waitingForPartner`)),1)]))])])]),_:1}),v(T(k),{class:`p-6`},{default:C(()=>[h(`h3`,ke,[v(T(j),{class:`h-5 w-5 mr-2`}),_(` `+E(T(f)(`couple.budgetSettings`)),1)]),h(`div`,Ae,[h(`div`,je,[h(`div`,Me,[v(T(i),null,{default:C(()=>[_(E(T(f)(`couple.monthlyBudget`)),1)]),_:1}),h(`div`,Ne,[v(T(O),{modelValue:J.value,"onUpdate:modelValue":c[2]||=e=>J.value=e,modelModifiers:{number:!0},type:`number`,min:`0`,step:`100`,class:`flex-1`},null,8,[`modelValue`]),h(`span`,Pe,E(T(l).coupleSettings?.currency||`TWD`),1)])]),h(`div`,Fe,[v(T(i),null,{default:C(()=>[_(E(T(f)(`couple.budgetStartDay`)),1)]),_:1}),v(T(r),{modelValue:Y.value,"onUpdate:modelValue":c[3]||=e=>Y.value=e},{default:C(()=>[v(T(t),null,{default:C(()=>[v(T(e),{placeholder:T(f)(`couple.selectDate`)},null,8,[`placeholder`])]),_:1}),v(T(ee),null,{default:C(()=>[(x(),g(m,null,S(28,e=>v(T(n),{key:e,value:e.toString()},{default:C(()=>[_(E(T(f)(`couple.dayOfMonth`,{day:e})),1)]),_:2},1032,[`value`])),64))]),_:1})]),_:1},8,[`modelValue`])])]),h(`div`,Ie,[v(T(i),null,{default:C(()=>[_(E(T(f)(`couple.categoryBudgetAllocation`)),1)]),_:1}),h(`div`,Le,[(x(!0),g(m,null,S(X,(e,t)=>(x(),g(`div`,{key:t,class:`space-y-1`},[v(T(i),{class:`text-sm capitalize`},{default:C(()=>[_(E(Z(t)),1)]),_:2},1024),v(T(O),{modelValue:X[t],"onUpdate:modelValue":e=>X[t]=e,modelModifiers:{number:!0},type:`number`,min:`0`,step:`100`,class:`text-sm`},null,8,[`modelValue`,`onUpdate:modelValue`])]))),128))]),h(`div`,Re,E(T(f)(`couple.total`))+`: `+E(Object.values(X).reduce((e,t)=>e+(t||0),0))+` `+E(T(l).coupleSettings?.currency||`TWD`),1)]),h(`div`,ze,[v(T(u),{onClick:qe,variant:`outline`},{default:C(()=>[_(E(T(f)(`couple.reset`)),1)]),_:1}),v(T(u),{onClick:Ke,disabled:T(l).loading},{default:C(()=>[v(T(N),{class:`h-4 w-4 mr-2`}),_(` `+E(T(f)(`couple.saveSettings`)),1)]),_:1},8,[`disabled`])])])]),_:1}),v(T(k),{class:`p-6 border-red-200`},{default:C(()=>[h(`h3`,Be,[v(T(P),{class:`h-5 w-5 mr-2`}),_(` `+E(T(f)(`couple.dangerZone`)),1)]),h(`div`,Ve,[h(`div`,He,[h(`p`,Ue,E(T(f)(`couple.leaveWarning`)),1),h(`ul`,We,[h(`li`,null,`• `+E(T(f)(`couple.leaveWarning1`)),1),h(`li`,null,`• `+E(T(f)(`couple.leaveWarning2`)),1),h(`li`,null,`• `+E(T(f)(`couple.leaveWarning3`)),1)])]),v(T(u),{onClick:Je,variant:`destructive`,disabled:T(l).loading},{default:C(()=>[v(T(o),{class:`h-4 w-4 mr-2`}),_(` `+E(T(f)(`couple.leaveCouple`)),1)]),_:1},8,[`disabled`])])]),_:1})])):(x(),g(`div`,U,[h(`div`,W,[v(T(M),{class:`h-16 w-16 text-[#9747FF] mx-auto mb-4`}),h(`h2`,G,E(T(f)(`couple.createOrJoin`)),1),h(`p`,K,E(T(f)(`couple.manageSharedExpenses`)),1)]),h(`div`,ce,[v(T(k),{class:`p-6`},{default:C(()=>[h(`div`,le,[v(T(I),{class:`h-12 w-12 text-[#9747FF] mx-auto`}),h(`h3`,ue,E(T(f)(`couple.createNew`)),1),h(`p`,de,E(T(f)(`couple.createDesc`)),1),h(`div`,fe,[v(T(O),{modelValue:D.value,"onUpdate:modelValue":c[0]||=e=>D.value=e,placeholder:T(f)(`couple.coupleNamePlaceholder`),class:`w-full`},null,8,[`modelValue`,`placeholder`]),v(T(u),{onClick:Q,disabled:T(l).loading,class:`w-full`},{default:C(()=>[v(T(ne),{class:`h-4 w-4 mr-2`}),_(` `+E(T(f)(`couple.create`)),1)]),_:1},8,[`disabled`])])])]),_:1}),v(T(k),{class:`p-6`},{default:C(()=>[h(`div`,pe,[v(T(F),{class:`h-12 w-12 text-[#9747FF] mx-auto`}),h(`h3`,me,E(T(f)(`couple.join`)),1),h(`p`,he,E(T(f)(`couple.joinDesc`)),1),h(`div`,ge,[v(T(O),{modelValue:q.value,"onUpdate:modelValue":c[1]||=e=>q.value=e,placeholder:T(f)(`couple.invitationCodePlaceholder`),class:`w-full`,maxlength:`8`},null,8,[`modelValue`,`placeholder`]),v(T(u),{onClick:$,disabled:T(l).loading||!q.value,class:`w-full`},{default:C(()=>[v(T(F),{class:`h-4 w-4 mr-2`}),_(` `+E(T(f)(`couple.joinButton`)),1)]),_:1},8,[`disabled`])])])]),_:1})])]))]))}}),J=D(q,[[`__scopeId`,`data-v-19ac0ab9`]]);const Y={class:`min-h-screen bg-background`},X={class:`px-4 pb-20`},Z={class:`mt-6`};var Q=y({__name:`CoupleSettings`,setup(e){let t=f(),n=()=>{t.back()};return(e,t)=>(x(),g(`div`,Y,[v(te,{title:e.$t(`couple.title`),"show-back-button":!0,onBack:n},null,8,[`title`]),h(`main`,X,[h(`div`,Z,[v(J)])])]))}}),$=Q;export{$ as default};